<script>
    let imageUrl = ""; // Qui salveremo il link della foto caricata

    async function uploadImage(file) {
        const cloudName = "dmzxzjy3b"; // <--- METTI IL TUO CLOUD NAME
        const uploadPreset = "qwonr5tg";   // <--- METTI IL TUO PRESET (UNSIGNED)
        
        const formData = new FormData();
        formData.append("file", file);
        formData.append("upload_preset", uploadPreset);

        document.getElementById('uploadText').innerText = "Caricamento in corso...";

        try {
            const res = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/image/upload`, {
                method: "POST",
                body: formData
            });
            const data = await res.json();
            imageUrl = data.secure_url;
            document.getElementById('uploadText').innerText = "âœ… Foto Caricata!";
        } catch (err) {
            alert("Errore nel caricamento foto. Riprova.");
            document.getElementById('uploadText').innerText = "Errore. Riprova.";
        }
    }

    function updateFileName(input) {
        if (input.files && input.files[0]) {
            uploadImage(input.files[0]);
        }
    }

    document.getElementById('tattooForm').onsubmit = function(e) {
        e.preventDefault();
        
        const numeroTatuatore = "393474184010"; // <--- IL TUO NUMERO

        const tipo = document.getElementById('tipoServizio').value;
        const nome = document.getElementById('nome').value;
        const idea = document.getElementById('idea').value;
        const fotoLink = imageUrl ? imageUrl : "Nessuna foto caricata";

        const testo = `ðŸŒ¿ *SANGUE E LACRIME STUDIO*%0A` +
                      `------------------------------%0A` +
                      `ðŸ”¥ *Tipo:* ${tipo}%0A` +
                      `ðŸ‘¤ *Cliente:* ${nome}%0A` +
                      `ðŸŽ¨ *Idea:* ${idea}%0A` +
                      `ðŸ–¼ï¸ *Foto:* ${fotoLink}%0A` +
                      `------------------------------`;

        window.location.href = `https://api.whatsapp.com/send?phone=${numeroTatuatore}&text=${testo}`;
    };
</script>
